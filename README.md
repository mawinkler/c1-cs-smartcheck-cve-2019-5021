# How to detect CVE-2019-5021 with Smart Check

- [How to detect CVE-2019-5021 with Smart Check](#how-to-detect-cve-2019-5021-with-smart-check)
  - [What is the problem?](#what-is-the-problem)
  - [Who is affected?](#who-is-affected)
  - [How to detect whether an image is vulnerable - manually](#how-to-detect-whether-an-image-is-vulnerable---manually)
  - [How to detect it with Smart Check - automatically](#how-to-detect-it-with-smart-check---automatically)
  - [Support](#support)
  - [Contribute](#contribute)


> Source Link: <https://alpinelinux.org/posts/Docker-image-vulnerability-CVE-2019-5021.html>

## What is the problem?

If you have the shadow package installed in your Docker container and run your service as non-root user, an attacker who compromised your system via an unrelated security vulnerabillity, or a user with shell access, could elevate their privileges to root within the container.

## Who is affected?

The issue only affects Docker images. If you used the Alpine linux installer, setup-alpine, you are not affected.

You are not affected unless you have shadow or linux-pam packages installed.

The issue was fixed in the following Docker image releases (7 March 2019):

- edge (20190228 snapshot)
- v3.9.2
- v3.8.4
- v3.7.3
- v3.6.5

The following versions are EOL and still vulnerable:

- v3.5
- v3.4
- v3.3

## How to detect whether an image is vulnerable - manually

```sh
$ cat /etc/shadow | grep root
```

A vulnerable container has the following output:

```sh
root:::0:::::
```

The `/etc/shadow` file stores the userâ€™s password in an encrypted format. It has a special format in which each line has the user name and fields (separated by a colon) that specifies information about the password, such as the encrypted password, change time, and expiration time.

The second field in the root account of the vulnerable Alpine image is empty. This means that the password is set to NULL.

## How to detect it with Smart Check - automatically

Within the Content Rules section add a rule with the following contents:

```yara
rule cve_2019_5021
{
    meta:
        description = "Finds CVE-2019-5021"
        severity = "critical"

    strings:
        $str = /^root::/

    condition:
        $str and (( filename == "etc/shadow" ))
}
```

## Support

This is an Open Source community project. Project contributors may be able to help, depending on their time and availability. Please be specific about what you're trying to do, your system, and steps to reproduce the problem.

For bug reports or feature requests, please [open an issue](../../issues). You are welcome to [contribute](#contribute).

Official support from Trend Micro is not available. Individual contributors may be Trend Micro employees, but are not official support.

## Contribute

I do accept contributions from the community. To submit changes:

1. Fork this repository.
1. Create a new feature branch.
1. Make your changes.
1. Submit a pull request with an explanation of your changes or additions.

I will review and work with you to release the code.
